<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Figma Plugin Diagnostics</title>
  <style>
    body {
      margin: 0;
      padding: 16px;
      font-family: 'Inter', system-ui, sans-serif;
      font-size: 12px;
      background: #ffffff;
    }
    
    .container {
      max-width: 300px;
    }
    
    h2 {
      margin: 0 0 16px 0;
      font-size: 14px;
      font-weight: 600;
      color: #333;
    }
    
    button {
      background: #18a0fb;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      font-size: 12px;
      cursor: pointer;
      width: 100%;
    }
    
    button:hover {
      background: #0d8ce8;
    }
    
    button:active {
      background: #0b7dd1;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Figma Plugin Diagnostics</h2>
    
    <div id="components-section">
      <h3 style="margin: 0 0 8px 0; font-size: 12px; color: #666;">Available Components:</h3>
      <div id="components-list" style="margin-bottom: 12px;">
        <p style="font-size: 11px; color: #999; font-style: italic;">Loading components...</p>
      </div>
      <button id="refresh" style="background: #666; margin-bottom: 12px;">Refresh List</button>
    </div>
    
    <div id="no-components" style="display: none;">
      <p style="font-size: 11px; color: #999; font-style: italic; text-align: center; margin: 20px 0;">
        No components found in this file.<br>
        Create some components first!
      </p>
    </div>
    
    <p style="font-size: 10px; color: #999; margin-top: 12px; line-height: 1.4;">
      Select a component to create an instance of it on the canvas
    </p>
  </div>

  <script>
    let availableComponents = [];

    // Listen for messages from the plugin code
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (msg.type === 'components-list') {
        availableComponents = msg.components;
        renderComponentsList();
      }
    };

    function renderComponentsList() {
      const listContainer = document.getElementById('components-list');
      const noComponentsDiv = document.getElementById('no-components');
      const componentsSection = document.getElementById('components-section');
      
      if (availableComponents.length === 0) {
        componentsSection.style.display = 'none';
        noComponentsDiv.style.display = 'block';
        return;
      }
      
      componentsSection.style.display = 'block';
      noComponentsDiv.style.display = 'none';
      
      listContainer.innerHTML = '';
      
      availableComponents.forEach(component => {
        const componentDiv = document.createElement('div');
        componentDiv.style.cssText = `
          padding: 8px;
          border: 1px solid #ddd;
          border-radius: 4px;
          margin-bottom: 4px;
          cursor: pointer;
          background: #f8f8f8;
        `;
        
        componentDiv.innerHTML = `
          <div style="font-weight: 600; font-size: 11px; color: #333;">${component.name}</div>
          <div style="font-size: 10px; color: #666; margin-top: 2px;">${component.description}</div>
        `;
        
        componentDiv.onclick = () => {
          parent.postMessage({ 
            pluginMessage: { 
              type: 'create-instance', 
              componentId: component.id 
            } 
          }, '*');
        };
        
        // Hover effects
        componentDiv.onmouseenter = () => {
          componentDiv.style.background = '#e8f4fd';
          componentDiv.style.borderColor = '#18a0fb';
        };
        componentDiv.onmouseleave = () => {
          componentDiv.style.background = '#f8f8f8';
          componentDiv.style.borderColor = '#ddd';
        };
        
        listContainer.appendChild(componentDiv);
      });
    }

    // Refresh button
    document.getElementById('refresh').onclick = () => {
      parent.postMessage({ pluginMessage: { type: 'refresh-components' } }, '*');
    };
  </script>
</body>
</html>